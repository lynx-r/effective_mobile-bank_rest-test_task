# –°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ –∫–∞—Ä—Ç–∞–º–∏

–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è REST API —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±–∞–Ω–∫–æ–≤—Å–∫–∏–º–∏ –∫–∞—Ä—Ç–∞–º–∏ —Å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–µ–π OAuth2 –∏ OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–µ–π.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

–°–∏—Å—Ç–µ–º–∞ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ —Ç—Ä–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –º–æ–¥—É–ª–µ–π:

### üì± bankcards (–û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å)
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ä–∂–∞—Ç–µ–ª—è–º–∏ –∫–∞—Ä—Ç –∏ –∫–∞—Ä—Ç–∞–º–∏
- –û–ø–µ—Ä–∞—Ü–∏–∏ —Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏
- –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ endpoints
- OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### üîê authorizationserver (–°–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏)  
- OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–ª—è–º–∏ –∏ –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞

### üîß common (–û–±—â–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- –û–±—â–∏–µ DTO –∏ –º–æ–¥–µ–ª–∏
- –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è –∞—É–¥–∏—Ç–∞
- –°–æ–±—ã—Ç–∏—è —Å–∏—Å—Ç–µ–º—ã

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

- **Backend**: Java 17, Spring Boot 3.x
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL —Å –º–∏–≥—Ä–∞—Ü–∏—è–º–∏ Flyway
- **–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è**: OAuth2 / OIDC
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: OpenAPI 3.0 (Swagger)
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker & Docker Compose
- **–°–±–æ—Ä–∫–∞**: Gradle

## –ë—ã—Å—Ç—Ä—ã–π –∑–∞–ø—É—Å–∫

### –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Java 17+
- Docker & Docker Compose
- Gradle 8.x

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –ó–∞–ø—É—Å–∫ PostgreSQL –≤ Docker
docker-compose up -d db

# –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (30 —Å–µ–∫—É–Ω–¥)
sleep 30
```

### 2. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–π

```bash
# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è authorizationserver
./gradlew authorizationserver:flywayMigrate

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π –¥–ª—è bankcards  
./gradlew bankcards:flywayMigrate
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

```bash
# –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
./gradlew authorizationserver:bootRun

# –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ - –∑–∞–ø—É—Å–∫ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –º–æ–¥—É–ª—è
./gradlew bankcards:bootRun
```

### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞
curl http://localhost:8080/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
open http://localhost:8080/swagger-ui.html
```

## API Endpoints

### üîó –ë–∞–∑–æ–≤—ã–µ endpoints

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| GET | `/` | –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ |
| GET | `/api/token` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ OAuth2 |

### üë§ –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|-----|----------|
| POST | `/auth/register` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è |
| POST | `/auth/login` | –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É |

### üí≥ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ | –†–æ–ª—å |
|-------|-----|----------|------|
| GET | `/api/cards` | –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –∫–∞—Ä—Ç—ã | USER |
| GET | `/api/cards/{id}` | –ü–æ–ª—É—á–∏—Ç—å –∫–∞—Ä—Ç—É –ø–æ ID | USER |
| POST | `/api/cards` | –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É | USER |
| PUT | `/api/cards/{id}` | –û–±–Ω–æ–≤–∏—Ç—å –∫–∞—Ä—Ç—É | USER |
| DELETE | `/api/cards/{id}` | –£–¥–∞–ª–∏—Ç—å –∫–∞—Ä—Ç—É | USER |

### üë• –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ endpoints

| –ú–µ—Ç–æ–¥ | URL | –û–ø–∏—Å–∞–Ω–∏–µ | –†–æ–ª—å |
|-------|-----|----------|------|
| GET | `/api/admin/cardholders` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ä–∂–∞—Ç–µ–ª—è–º–∏ | ADMIN |
| GET | `/api/admin/cards` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–∞–º–∏ | ADMIN |
| GET | `/api/admin/transactions` | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è–º–∏ | ADMIN |

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

#### authorizationserver
```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/authdb
    username: authuser
    password: authpass
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:9000
```

#### bankcards
```yaml
spring:
  datasource:
    url: jdbc:postgresql://localhost:5432/carddb
    username: carduser  
    password: cardpass
  security:
    oauth2:
      resourceserver:
        jwt:
          issuer-uri: http://localhost:9000
```

### OAuth2 –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç OAuth2 —Å OIDC –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–º:
- **Authorization Server**: http://localhost:9000
- **Client ID**: oidc-client
- **Grant Type**: Authorization Code with PKCE

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API

–ü–æ–ª–Ω–∞—è OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å–∞–º:
- **bankcards**: http://localhost:8080/swagger-ui.html
- **authorizationserver**: http://localhost:9000/swagger-ui.html

### –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤

#### –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
```bash
# 1. –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä
open http://localhost:9000/oauth2/authorize?response_type=code&client_id=oidc-client&scope=openid&redirect_uri=http://localhost:8080/api/token

# 2. –û–±–º–µ–Ω –∫–æ–¥–∞ –Ω–∞ —Ç–æ–∫–µ–Ω
curl -X GET http://localhost:8080/api/token \
  -H "Authorization: Bearer {access_token}"
```

#### –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç—ã
```bash
curl -X POST http://localhost:8080/api/cards \
  -H "Authorization: Bearer {access_token}" \
  -H "Content-Type: application/json" \
  -d '{
    "cardholderId": 1,
    "cardType": "DEBIT",
    "currency": "RUB"
  }'
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
./gradlew test

# –¢–µ—Å—Ç—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –º–æ–¥—É–ª—è
./gradlew bankcards:test
./gradlew authorizationserver:test
```

### –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
```bash
# –ó–∞–ø—É—Å–∫ —Å –ø—Ä–æ—Ñ–∏–ª–µ–º test
./gradlew bankcards:bootRun --args='--spring.profiles.active=test'
```

## –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ö–µ–º

#### authdb (authorizationserver)
- `users` - –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å–∏—Å—Ç–µ–º—ã
- `roles` - —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- `user_roles` - —Å–≤—è–∑–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ —Ä–æ–ª–µ–π

#### carddb (bankcards)  
- `cardholders` - –¥–µ—Ä–∂–∞—Ç–µ–ª–∏ –∫–∞—Ä—Ç
- `cards` - –±–∞–Ω–∫–æ–≤—Å–∫–∏–µ –∫–∞—Ä—Ç—ã
- `transactions` - —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏

### –ú–∏–≥—Ä–∞—Ü–∏–∏
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏–∏ Flyway:
- V001__Create_users_table.sql
- V002_Create_roles_table.sql  
- V003_Insert_default_data.sql

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- OAuth2 / OIDC –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
- –†–æ–ª–µ–≤–æ–π –¥–æ—Å—Ç—É–ø (USER, ADMIN)
- –ó–∞—â–∏—Ç–∞ –æ—Ç CSRF –∞—Ç–∞–∫
- CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

- Spring Boot Actuator –¥–ª—è –º–µ—Ç—Ä–∏–∫
- –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ê—É–¥–∏—Ç –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- Graceful shutdown

## –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
effective_mobile-bank_rest-test_task/
‚îú‚îÄ‚îÄ bankcards/                 # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ src/main/java/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ com/example/bankcards/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ controller/   # REST –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ service/      # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ repository/   # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ JPA
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ entity/       # –°—É—â–Ω–æ—Å—Ç–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ config/       # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ src/main/resources/
‚îÇ       ‚îú‚îÄ‚îÄ static/openapi.yaml
