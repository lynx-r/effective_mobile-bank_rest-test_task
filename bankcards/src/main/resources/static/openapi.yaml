openapi: 3.0.3
info:
  title: Банковская REST API система
  description: |
    Полная документация API банковской системы для управления картами и пользователями.
    
    ## Основные возможности:
    - Регистрация и аутентификация пользователей
    - Управление банковскими картами
    - Переводы между картами
    - Административные функции
    
    ## Безопасность:
    - JWT аутентификация
    - Ролевая модель доступа (USER/ADMIN)
    - Шифрование чувствительных данных
    
    ## Аутентификация:
    Все endpoints (кроме регистрации) требуют Bearer токен в заголовке:
    ```
    Authorization: Bearer {jwt_token}
    ```
  version: 1.0.0
  contact:
    name: API Support
    email: support@bank.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://client-app:8080
    description: Локальный сервер разработки

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT токен для аутентификации

  schemas:
    CreateCardRequest:
      type: object
      required:
        - cardholderId
      properties:
        cardholderId:
          type: integer
          format: int64
          minimum: 1
          description: ID пользователя для создания карты
          example: 1

    CardResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Уникальный идентификатор карты
          example: 1
        ownerName:
          type: string
          description: ФИО владельца карты
          example: "Иван Иванов"
        cardNumberMasked:
          type: string
          description: Замаскированный номер карты
          example: "1234 **** **** 5678"
        status:
          type: string
          enum: [ACTIVE, BLOCKED, EXPIRED]
          description: Статус карты
          example: "ACTIVE"
        balance:
          type: number
          format: decimal
          description: Текущий баланс карты
          example: 15000.50
        isBlockRequested:
          type: boolean
          description: Флаг запроса на блокировку
          example: false
        blockRequestedAt:
          type: string
          format: date-time
          nullable: true
          description: Дата запроса блокировки
          example: null
        cardholderId:
          type: integer
          format: int64
          description: ID владельца карты
          example: 1

    CardholderResponse:
      type: object
      properties:
        id:
          type: integer
          format: int64
          description: Уникальный идентификатор пользователя
          example: 1
        username:
          type: string
          description: Имя пользователя
          example: "user1"
        email:
          type: string
          format: email
          description: Электронная почта
          example: "user1@example.com"
        firstName:
          type: string
          description: Имя пользователя
          example: "John"
        lastName:
          type: string
          description: Фамилия пользователя
          example: "Doe"
        enabled:
          type: boolean
          description: Статус активности пользователя
          example: true

    InternalTransferRequest:
      type: object
      required:
        - fromCardId
        - toCardId
        - amount
      properties:
        fromCardId:
          type: integer
          format: int64
          minimum: 1
          description: ID карты-отправителя
          example: 1
        toCardId:
          type: integer
          format: int64
          minimum: 1
          description: ID карты-получателя
          example: 2
        amount:
          type: number
          format: decimal
          minimum: 0.01
          maximum: 1000000000
          description: Сумма перевода
          example: 1000.00

    PageCardResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/CardResponse'
        totalElements:
          type: integer
          format: int64
          description: Общее количество элементов
          example: 1
        totalPages:
          type: integer
          description: Общее количество страниц
          example: 1
        size:
          type: integer
          description: Размер страницы
          example: 20
        number:
          type: integer
          description: Номер текущей страницы
          example: 0
        first:
          type: boolean
          description: Является ли страница первой
          example: true
        last:
          type: boolean
          description: Является ли страница последней
          example: true
        empty:
          type: boolean
          description: Пустая ли страница
          example: false

    PageCardholderResponse:
      type: object
      properties:
        content:
          type: array
          items:
            $ref: '#/components/schemas/CardholderResponse'
        totalElements:
          type: integer
          format: int64
          description: Общее количество элементов
          example: 1
        totalPages:
          type: integer
          description: Общее количество страниц
          example: 1
        size:
          type: integer
          description: Размер страницы
          example: 20
        number:
          type: integer
          description: Номер текущей страницы
          example: 0
        first:
          type: boolean
          description: Является ли страница первой
          example: true
        last:
          type: boolean
          description: Является ли страница последней
          example: true
        empty:
          type: boolean
          description: Пустая ли страница
          example: false

    ErrorResponse:
      type: object
      properties:
        timestamp:
          type: string
          format: date-time
          description: Время возникновения ошибки
        status:
          type: integer
          description: HTTP статус код
        error:
          type: string
          description: Название ошибки
        message:
          type: string
          description: Сообщение об ошибке
        path:
          type: string
          description: Путь к ресурсу

    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
          description: JWT токен доступа
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIn0.dozjgNryP4J3jVmNHl0w5N_XgL0n3I9PlFUP0THsR8U"
        refresh_token:
          type: string
          description: Токен обновления
          example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.refresh_token_example"

  parameters:
    CardId:
      name: cardId
      in: path
      required: true
      schema:
        type: integer
        format: int64
      description: ID карты
      example: 1
    
    CardholderId:
      name: id
      in: path
      required: true
      schema:
        type: integer
        format: int64
      description: ID пользователя
      example: 1
    
    SearchParam:
      name: search
      in: query
      required: false
      schema:
        type: string
      description: Поисковый запрос
      example: "иван"
    
    PageParam:
      name: page
      in: query
      required: false
      schema:
        type: integer
        minimum: 0
        default: 0
      description: Номер страницы
      example: 0
    
    SizeParam:
      name: size
      in: query
      required: false
      schema:
        type: integer
        minimum: 1
        maximum: 100
        default: 20
      description: Размер страницы
      example: 20
    
    SortParam:
      name: sort
      in: query
      required: false
      schema:
        type: string
      description: "Сортировка (формат: поле,направление)"
      example: "id,desc"
    
    StatusParam:
      name: status
      in: query
      required: true
      schema:
        type: string
        enum: [ACTIVE, BLOCKED, EXPIRED]
      description: Статус карты

  responses:
    BadRequest:
      description: Ошибка валидации входных данных
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2023-12-01T10:30:00"
            status: 400
            error: "Bad Request"
            message: "Validation failed"
    
    Unauthorized:
      description: Отсутствует или недействительный токен
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2023-12-01T10:30:00"
            status: 401
            error: "Unauthorized"
            message: "Full authentication is required to access this resource"
    
    Forbidden:
      description: Недостаточно прав доступа
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2023-12-01T10:30:00"
            status: 403
            error: "Forbidden"
            message: "Access is denied"
    
    NotFound:
      description: Ресурс не найден
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            timestamp: "2023-12-01T10:30:00"
            status: 404
            error: "Not Found"
            message: "Resource not found"

paths:
  /api/cardholder/cards:
    get:
      tags:
        - Cardholder Cards
      summary: Получение списка своих карт
      description: Возвращает пагинированный список карт текущего пользователя
      operationId: getMyCards
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SearchParam'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
        - $ref: '#/components/parameters/SortParam'
      responses:
        '200':
          description: Список карт успешно получен
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageCardResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /api/cardholder/cards/{cardId}/block:
    patch:
      tags:
        - Cardholder Cards
      summary: Запрос блокировки карты
      description: Пользователь запрашивает блокировку своей карты
      operationId: requestCardBlock
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CardId'
      responses:
        '204':
          description: Запрос на блокировку принят
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Карта уже заблокирована
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/cardholder/transfer:
    post:
      tags:
        - Cardholder Cards
      summary: Перевод между своими картами
      description: Выполняет перевод денег между картами одного пользователя
      operationId: transferBetweenCards
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/InternalTransferRequest'
            example:
              fromCardId: 1
              toCardId: 2
              amount: 1000.00
      responses:
        '204':
          description: Перевод выполнен успешно
        '400':
          $ref: '#/components/responses/BadRequest'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Недостаточно средств или карты заблокированы
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/cardholder/cards/{cardId}/balance:
    get:
      tags:
        - Cardholder Cards
      summary: Получение баланса карты
      description: Возвращает текущий баланс указанной карты
      operationId: getCardBalance
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CardId'
      responses:
        '200':
          description: Баланс карты
          content:
            application/json:
              schema:
                type: number
                format: decimal
                example: 15000.50
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/admin/cards:
    get:
      tags:
        - Admin Cards
      summary: Получение всех карт
      description: Возвращает пагинированный список всех карт в системе (только для администраторов)
      operationId: getAllCards
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SearchParam'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
        - $ref: '#/components/parameters/SortParam'
      responses:
        '200':
          description: Список всех карт
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageCardResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

    post:
      tags:
        - Admin Cards
      summary: Создание новой карты
      description: Создает новую карту для указанного пользователя
      operationId: createCard
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCardRequest'
            example:
              cardholderId: 1
      responses:
        '201':
          description: Карта успешно создана
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CardResponse'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Пользователь не найден
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '409':
          description: Пользователь заблокирован
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /api/admin/cards/{id}/status:
    patch:
      tags:
        - Admin Cards
      summary: Изменение статуса карты
      description: Изменяет статус карты (активна/заблокирована/просрочена)
      operationId: updateCardStatus
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID карты
          example: 1
        - $ref: '#/components/parameters/StatusParam'
      responses:
        '204':
          description: Статус карты изменен
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/admin/cards/{id}:
    delete:
      tags:
        - Admin Cards
      summary: Удаление карты
      description: Удаляет карту из системы (мягкое удаление)
      operationId: deleteCard
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          schema:
            type: integer
            format: int64
          description: ID карты
          example: 1
      responses:
        '204':
          description: Карта удалена
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/admin/cardholders:
    get:
      tags:
        - Admin Cardholders
      summary: Получение всех пользователей
      description: Возвращает пагинированный список всех пользователей системы
      operationId: getAllCardholders
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/SearchParam'
        - $ref: '#/components/parameters/PageParam'
        - $ref: '#/components/parameters/SizeParam'
        - $ref: '#/components/parameters/SortParam'
      responses:
        '200':
          description: Список всех пользователей
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PageCardholderResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'

  /api/admin/cardholders/{id}/block:
    put:
      tags:
        - Admin Cardholders
      summary: Блокировка пользователя
      description: Блокирует пользователя в системе
      operationId: blockCardholder
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CardholderId'
      responses:
        '204':
          description: Пользователь заблокирован
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/admin/cardholders/{id}:
    delete:
      tags:
        - Admin Cardholders
      summary: Удаление пользователя
      description: Удаляет пользователя из системы (мягкое удаление)
      operationId: deleteCardholder
      security:
        - bearerAuth: []
      parameters:
        - $ref: '#/components/parameters/CardholderId'
      responses:
        '204':
          description: Пользователь удален
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'

  /:
    get:
      tags:
        - Home
      summary: Базовый эндпоинт
      description: Возвращает приветственное сообщение
      operationId: home
      responses:
        '200':
          description: Успешный ответ
          content:
            application/json:
              schema:
                type: string
                example: "Hello World!"

  /api/token:
    get:
      tags:
        - Token
      summary: Получение токенов
      description: Возвращает access_token и refresh_token для авторизованного пользователя
      operationId: getToken
      responses:
        '200':
          description: Токены успешно получены
          content:
            application/json:
              schema:
                type: object
                properties:
                  access_token:
                    type: string
                    description: JWT токен доступа
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
                  refresh_token:
                    type: string
                    description: Токен обновления
                    example: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.refresh_token_example"

tags:
  - name: Authentication
    description: Endpoints для аутентификации и регистрации
  - name: Cardholder Cards
    description: Endpoints для работы пользователей со своими картами
  - name: Admin Cards
    description: Административные endpoints для управления картами
  - name: Admin Cardholders
    description: Административные endpoints для управления пользователями
  - name: Home
    description: Базовые endpoints для главной страницы
  - name: Token
    description: Endpoints для работы с токенами
